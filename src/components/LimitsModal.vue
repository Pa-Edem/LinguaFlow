<!-- src/components/LimitsModal.vue -->
<template>
  <div class="limits-modal-content">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å —Ç–∞—Ä–∏—Ñ–æ–º -->
    <!-- <div class="modal-tier-badge">
      <span class="tier-label">–í–∞—à —Ç–∞—Ä–∏—Ñ:</span>
      <span class="tier-badge" :class="userStore.tier">
        {{ userStore.tierName }}
      </span>
    </div> -->

    <!-- ‚úÖ –î–ª—è PREMIUM –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
    <div v-if="userStore.isPremium" class="premium-unlimited">
      <div class="premium-icon">üëë</div>
      <div class="premium-title">PREMIUM - –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø</div>
      <div class="premium-description">
        –£ –≤–∞—Å –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π!
      </div>
      <div class="premium-features">
        <div class="premium-feature">‚úì –ë–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</div>
        <div class="premium-feature">‚úì –ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</div>
        <div class="premium-feature">‚úì –í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤</div>
        <div class="premium-feature">‚úì –í—Å–µ —É—Ä–æ–≤–Ω–∏ A1 - C2</div>
        <div class="premium-feature">‚úì AI-–∞–Ω–∞–ª–∏–∑ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div class="premium-feature">‚úì –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</div>
      </div>
    </div>

    <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ -->
    <!-- <div class="limit-card">
      <div class="card-header">
        <div class="card-header-left">
          <span class="card-icon">üéØ</span>
          <div class="card-title">
            <div class="title-main">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</div>
            <div class="title-sub">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤</div>
          </div>
        </div>
        <div class="card-header-right">
          <div class="modal-tier-badge">
            <span v-if="isDesktop" class="tier-label">–í–∞—à —Ç–∞—Ä–∏—Ñ:</span>
            <span class="tier-badge" :class="userStore.tier">
              {{ userStore.tierName }}
            </span>
          </div>
        </div>
      </div>

      <div class="card-stats">
        <div class="stat-item">
          <div class="stat-label">–ù–∞–∫–æ–ø–ª–µ–Ω–æ</div>
          <div class="stat-value large">
            {{ settingsStore.accumulatedGenerations }}
            <span class="stat-max">/ {{ settingsStore.limit.weeklyGenerationsCap }}</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">–ú–æ–∂–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
          <div class="stat-value">{{ settingsStore.canUseToday }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
          <div class="stat-value">{{ settingsStore.dailyUsageToday }}</div>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill generation" :style="{ width: `${settingsStore.generationsProgress}%` }"></div>
        </div>
        <div class="progress-text">
          {{ settingsStore.accumulatedGenerations }} –Ω–∞–∫–æ–ø–ª–µ–Ω–æ ‚Ä¢ –î–æ {{ settingsStore.limit.dailyGenerationsMax }}/–¥–µ–Ω—å
          –º–∞–∫—Å–∏–º—É–º
        </div>
      </div>

      <div class="hint-box">
        <span class="hint-icon">üí°</span>
        <div class="hint-text">
          –ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –¥–æ {{ settingsStore.limit.weeklyGenerationsCap }} –º–∞–∫—Å–∏–º—É–º. –°–±—Ä–æ—Å
          –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 00:00.
        </div>
      </div>
    </div> -->
    <!-- PRO-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
    <!-- <div class="limit-card">
      <div class="card-header">
        <div class="card-header-left">
          <span class="card-icon">üí™</span>
          <div class="card-title">
            <div class="title-main">PRO-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
            <div class="title-sub">–ì–æ–≤–æ—Ä–∏—Ç—å ‚Ä¢ –ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å</div>
          </div>
        </div>
        <div class="card-header-right">
          <div class="modal-tier-badge">
            <span v-if="isDesktop" class="tier-label">–í–∞—à —Ç–∞—Ä–∏—Ñ:</span>
            <span class="tier-badge" :class="userStore.tier">
              {{ userStore.tierName }}
            </span>
          </div>
        </div>
      </div>

      <div class="card-stats">
        <div class="stat-item">
          <div class="stat-label">–ù–∞–∫–æ–ø–ª–µ–Ω–æ</div>
          <div class="stat-value large">
            {{ settingsStore.accumulatedPreview }}
            <span class="stat-max">/ {{ settingsStore.limit.weeklyPreviewCap }}</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">–ú–æ–∂–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
          <div class="stat-value">{{ settingsStore.canUsePreviewToday }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
          <div class="stat-value">{{ settingsStore.dailyPreviewToday }}</div>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill preview" :style="{ width: `${settingsStore.previewProgress}%` }"></div>
        </div>
        <div class="progress-text">
          {{ settingsStore.accumulatedPreview }} –Ω–∞–∫–æ–ø–ª–µ–Ω–æ ‚Ä¢ –î–æ {{ settingsStore.limit.dailyPreviewMax }}/–¥–µ–Ω—å –º–∞–∫—Å–∏–º—É–º
        </div>
      </div>

      <div class="hint-box" v-if="userStore.tier === 'starter' && settingsStore.limit.unlimitedAnalysis">
        <span class="hint-icon">‚≠ê</span>
        <div class="hint-text"><strong>STARTER –±–æ–Ω—É—Å:</strong> –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤!</div>
      </div>
    </div> -->
    <!-- –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ -->
    <!-- <div class="limit-card">
      <div class="card-header">
        <div class="card-header-left">
          <span class="card-icon">üìö</span>
          <div class="card-title">
            <div class="title-main">–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏</div>
            <div class="title-sub">–í–∞—à–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</div>
          </div>
        </div>
        <div class="card-header-right">
          <div class="modal-tier-badge">
            <span v-if="isDesktop" class="tier-label">–í–∞—à —Ç–∞—Ä–∏—Ñ:</span>
            <span class="tier-badge" :class="userStore.tier">
              {{ userStore.tierName }}
            </span>
          </div>
        </div>
      </div>

      <div class="card-stats">
        <div class="stat-item">
          <div class="stat-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</div>
          <div class="stat-value large">
            {{ totalDialogs }}
            <span class="stat-max">/ {{ settingsStore.limit.totalDialogs }}</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">–°–≤–æ–±–æ–¥–Ω–æ</div>
          <div class="stat-value">{{ settingsStore.limit.totalDialogs - totalDialogs }}</div>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill storage" :style="{ width: `${storageProgress}%` }"></div>
        </div>
        <div class="progress-text">{{ storageProgress }}% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</div>
      </div>
    </div> -->
    <!-- CTA –¥–ª—è upgrade (—Ç–æ–ª—å–∫–æ –¥–ª—è FREE) -->
    <!-- <div v-if="userStore.tier === 'free'" class="upgrade-section">
      <div class="upgrade-icon">‚≠ê</div>
      <div class="upgrade-content">
        <div class="upgrade-title">–•–æ—Ç–∏—Ç–µ –±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π?</div>
        <div class="upgrade-features">
          <div class="feature-item">‚úì STARTER: 50 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–Ω–µ–¥–µ–ª—é</div>
          <div class="feature-item">‚úì PRO: –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É</div>
        </div>
        <div class="upgrade-price">–û—Ç $4.99/–º–µ—Å—è—Ü</div>
      </div>
      <button class="upgrade-btn" @click="goToPricing">–°—Ä–∞–≤–Ω–∏—Ç—å –ø–ª–∞–Ω—ã</button>
    </div> -->
    <!-- Info –¥–ª—è STARTER -->
    <!-- <div v-else-if="userStore.tier === 'starter'" class="info-section">
      <div class="info-icon">üíé</div>
      <div class="info-text">
        <strong>STARTER –ø–ª–∞–Ω:</strong> –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π! –•–æ—Ç–∏—Ç–µ –±–æ–ª—å—à–µ? –û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ PRO –¥–ª—è
        –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
      </div>
      <button class="info-btn" @click="goToPricing">–£–∑–Ω–∞—Ç—å –æ PRO</button>
    </div> -->
    <!-- –°–ª–µ–¥—É—é—â–∏–π —Å–±—Ä–æ—Å -->
    <!-- <div class="reset-info">
      <span class="reset-icon">üîÑ</span>
      <span class="reset-text">
        –õ–∏–º–∏—Ç—ã –æ–±–Ω–æ–≤—è—Ç—Å—è: <strong>{{ nextMonday }}</strong>
      </span>
    </div> -->

    <!-- ‚úÖ –î–ª—è FREE –∏ PRO –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã -->
    <template v-else>
      <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ -->
      <div class="limit-card">
        <div class="card-header">
          <div class="card-header-left">
            <span class="card-icon">üéØ</span>
            <div class="card-title">
              <div class="title-main">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</div>
              <div class="title-sub">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤</div>
            </div>
          </div>
          <div class="card-header-right">
            <div class="modal-tier-badge">
              <span v-if="isDesktop" class="tier-label">–í–∞—à —Ç–∞—Ä–∏—Ñ:</span>
              <span class="tier-badge" :class="userStore.tier">
                {{ userStore.tierName }}
              </span>
            </div>
          </div>
        </div>

        <div class="card-stats">
          <div class="stat-item">
            <div class="stat-label">–ù–∞–∫–æ–ø–ª–µ–Ω–æ</div>
            <div class="stat-value large">
              {{ settingsStore.accumulatedGenerations }}
              <span class="stat-max">/ {{ settingsStore.limit.weeklyGenerationsCap }}</span>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–ú–æ–∂–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
            <div class="stat-value">{{ settingsStore.canUseToday }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
            <div class="stat-value">{{ settingsStore.dailyUsageToday }}</div>
          </div>
        </div>

        <div class="progress-section">
          <div class="progress-bar">
            <div class="progress-fill generation" :style="{ width: `${settingsStore.generationsProgress}%` }"></div>
          </div>
          <div class="progress-text">
            {{ settingsStore.accumulatedGenerations }} –Ω–∞–∫–æ–ø–ª–µ–Ω–æ ‚Ä¢ –î–æ {{ settingsStore.limit.dailyGenerationsMax }}/–¥–µ–Ω—å
            –º–∞–∫—Å–∏–º—É–º
          </div>
        </div>

        <div class="hint-box">
          <span class="hint-icon">üí°</span>
          <div class="hint-text">
            –ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –¥–æ {{ settingsStore.limit.weeklyGenerationsCap }} –º–∞–∫—Å–∏–º—É–º. –°–±—Ä–æ—Å
            –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 00:00.
          </div>
        </div>
      </div>

      <!-- PRO-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
      <div class="limit-card">
        <div class="card-header">
          <div class="card-header-left">
            <span class="card-icon">üí™</span>
            <div class="card-title">
              <div class="title-main">PRO-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
              <div class="title-sub">–ì–æ–≤–æ—Ä–∏—Ç—å ‚Ä¢ –ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å</div>
            </div>
          </div>
          <div class="card-header-right">
            <div class="modal-tier-badge">
              <span v-if="isDesktop" class="tier-label">–í–∞—à —Ç–∞—Ä–∏—Ñ:</span>
              <span class="tier-badge" :class="userStore.tier">
                {{ userStore.tierName }}
              </span>
            </div>
          </div>
        </div>

        <div class="card-stats">
          <div class="stat-item">
            <div class="stat-label">–ù–∞–∫–æ–ø–ª–µ–Ω–æ</div>
            <div class="stat-value large">
              {{ settingsStore.accumulatedPreview }}
              <span class="stat-max">/ {{ settingsStore.limit.weeklyPreviewCap }}</span>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–ú–æ–∂–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
            <div class="stat-value">{{ settingsStore.canUsePreviewToday }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
            <div class="stat-value">{{ settingsStore.dailyPreviewToday }}</div>
          </div>
        </div>

        <div class="progress-section">
          <div class="progress-bar">
            <div class="progress-fill preview" :style="{ width: `${settingsStore.previewProgress}%` }"></div>
          </div>
          <div class="progress-text">
            {{ settingsStore.accumulatedPreview }} –Ω–∞–∫–æ–ø–ª–µ–Ω–æ ‚Ä¢ –î–æ {{ settingsStore.limit.dailyPreviewMax }}/–¥–µ–Ω—å
            –º–∞–∫—Å–∏–º—É–º
          </div>
        </div>

        <!-- ‚úÖ –û–ë–ù–û–í–õ–ï–ù–û: PRO –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ -->
        <div class="hint-box" v-if="userStore.isPro && settingsStore.limit.unlimitedAnalysis">
          <span class="hint-icon">‚≠ê</span>
          <div class="hint-text"><strong>PRO –±–æ–Ω—É—Å:</strong> –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤!</div>
        </div>
      </div>

      <!-- –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ -->
      <div class="limit-card">
        <div class="card-header">
          <div class="card-header-left">
            <span class="card-icon">üìö</span>
            <div class="card-title">
              <div class="title-main">–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏</div>
              <div class="title-sub">–í–∞—à–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</div>
            </div>
          </div>
          <div class="card-header-right">
            <div class="modal-tier-badge">
              <span v-if="isDesktop" class="tier-label">–í–∞—à —Ç–∞—Ä–∏—Ñ:</span>
              <span class="tier-badge" :class="userStore.tier">
                {{ userStore.tierName }}
              </span>
            </div>
          </div>
        </div>

        <div class="card-stats">
          <div class="stat-item">
            <div class="stat-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</div>
            <div class="stat-value large">
              {{ totalDialogs }}
              <span class="stat-max">/ {{ settingsStore.limit.totalDialogs }}</span>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–°–≤–æ–±–æ–¥–Ω–æ</div>
            <div class="stat-value">{{ settingsStore.limit.totalDialogs - totalDialogs }}</div>
          </div>
        </div>

        <div class="progress-section">
          <div class="progress-bar">
            <div class="progress-fill storage" :style="{ width: `${storageProgress}%` }"></div>
          </div>
          <div class="progress-text">{{ storageProgress }}% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</div>
        </div>
      </div>

      <!-- CTA –¥–ª—è upgrade (—Ç–æ–ª—å–∫–æ –¥–ª—è FREE) -->
      <div v-if="userStore.tier === 'free'" class="upgrade-section">
        <div class="upgrade-icon">‚≠ê</div>
        <div class="upgrade-content">
          <div class="upgrade-title">–•–æ—Ç–∏—Ç–µ –±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π?</div>
          <div class="upgrade-features">
            <div class="feature-item">‚úì PRO: 50 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–Ω–µ–¥–µ–ª—é, –≤—Å–µ —É—Ä–æ–≤–Ω–∏</div>
            <div class="feature-item">‚úì PREMIUM: –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø + AI-–∞–Ω–∞–ª–∏–∑</div>
          </div>
          <div class="upgrade-price">–û—Ç ‚Ç¨4.99/–º–µ—Å—è—Ü</div>
        </div>
        <button class="upgrade-btn" @click="goToPricing">–°—Ä–∞–≤–Ω–∏—Ç—å –ø–ª–∞–Ω—ã</button>
      </div>

      <!-- Info –¥–ª—è PRO -->
      <div v-else-if="userStore.isPro" class="info-section">
        <div class="info-icon">üíé</div>
        <div class="info-text">
          <strong>PRO –ø–ª–∞–Ω:</strong> –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π! –•–æ—Ç–∏—Ç–µ –±–µ–∑–ª–∏–º–∏—Ç? –û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ PREMIUM –¥–ª—è
          –ø–æ–ª–Ω–æ–π —Å–≤–æ–±–æ–¥—ã.
        </div>
        <button class="info-btn" @click="goToPricing">–£–∑–Ω–∞—Ç—å –æ PREMIUM</button>
      </div>

      <!-- –°–ª–µ–¥—É—é—â–∏–π —Å–±—Ä–æ—Å -->
      <div class="reset-info">
        <span class="reset-icon">üîÑ</span>
        <span class="reset-text">
          –õ–∏–º–∏—Ç—ã –æ–±–Ω–æ–≤—è—Ç—Å—è: <strong>{{ nextMonday }}</strong>
        </span>
      </div>
    </template>
  </div>
</template>

<script setup>
import { computed } from 'vue';
import { useRouter } from 'vue-router';
import { useUserStore } from '../stores/userStore';
import { useSettingsStore } from '../stores/settingsStore';
import { useDialogStore } from '../stores/dialogStore';
import { useUiStore } from '../stores/uiStore';
import { useBreakpoint } from '../composables/useBreakpoint';

const router = useRouter();
const userStore = useUserStore();
const settingsStore = useSettingsStore();
const dialogStore = useDialogStore();
const uiStore = useUiStore();
const { isDesktop } = useBreakpoint();

// –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–∞–ª–æ–≥–æ–≤
const totalDialogs = computed(() => dialogStore.allDialogs.length);

// –ü—Ä–æ–≥—Ä–µ—Å—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
const storageProgress = computed(() => {
  const max = settingsStore.limit.totalDialogs;
  if (max === 0) return 0;
  return Math.round((totalDialogs.value / max) * 100);
});

// –°–ª–µ–¥—É—é—â–∏–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
const nextMonday = computed(() => {
  const today = new Date();
  const dayOfWeek = today.getDay();
  const daysUntilMonday = dayOfWeek === 0 ? 1 : 8 - dayOfWeek;
  const nextMon = new Date(today);
  nextMon.setDate(today.getDate() + daysUntilMonday);
  return nextMon.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
});

// –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–∞—Ä–∏—Ñ–æ–≤
const goToPricing = () => {
  uiStore.hideModal();
  router.push('/pricing');
};
</script>

<style scoped>
.limits-modal-content {
  padding: 0;
}

.premium-unlimited {
  text-align: center;
  padding: 32px 24px;
  background: linear-gradient(135deg, #f6ad5515 0%, #ed893615 100%);
  border: 2px solid #f6ad55;
  border-radius: 12px;
  margin-bottom: 16px;
}

.premium-icon {
  font-size: 4rem;
  margin-bottom: 16px;
}

.premium-title {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--xl);
  font-weight: 700;
  color: var(--text-head);
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.premium-description {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--md);
  color: var(--text-base);
  margin-bottom: 24px;
  line-height: 1.6;
}

.premium-features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
  margin-top: 16px;
}

.premium-feature {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--sm);
  color: var(--text-base);
  text-align: left;
  padding: 8px 12px;
  background: var(--bg-side);
  border-radius: 8px;
}

.modal-tier-badge {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  background: var(--bg-side);
  border-radius: 12px;
}

.tier-label {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--sm);
  color: var(--text-base);
}

.tier-badge {
  padding: 6px 16px;
  border-radius: 20px;
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--sm);
  font-weight: 700;
  letter-spacing: 0.5px;
}

.tier-badge.free {
  background: #e2e8f0;
  color: #475569;
}

.tier-badge.pro {
  background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
  color: white;
}

.tier-badge.premium {
  background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
  color: white;
}

.limit-card {
  background: var(--bg-side);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
  border: 1px solid var(--border);
}

.card-header {
  display: flex;
  flex-wrap: nowrap;
  margin-bottom: 16px;
}
.card-header-left {
  display: flex;
  flex-grow: 1;
  align-items: center;
}
.card-header-right {
  display: flex;
  align-items: center;
}

.card-icon {
  font-size: 2rem;
}

.card-title {
  flex: 1;
}

.title-main {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--sm);
  font-weight: 500;
  color: var(--text-head);
}

.title-sub {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--xs);
  color: var(--text-title);
}

.card-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 12px;
  margin-bottom: 16px;
}

.stat-item {
  text-align: center;
  padding: 12px;
  background: var(--bg-main);
  border-radius: 8px;
}

.stat-label {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--xxs);
  color: var(--text-title);
  margin-bottom: 4px;
}

.stat-value {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--lg);
  font-weight: 700;
  color: var(--text-head);
}

.stat-value.large {
  font-size: var(--xl);
}

.stat-max {
  font-size: var(--md);
  color: var(--text-title);
  font-weight: 400;
}

.progress-section {
  margin-bottom: 12px;
}

.progress-bar {
  height: 8px;
  background: var(--y3);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
}

.progress-fill.generation {
  background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
}

.progress-fill.preview {
  background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
}

.progress-fill.storage {
  background: linear-gradient(90deg, #ed8936 0%, #dd6b20 100%);
}

.progress-text {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--xxs);
  color: var(--text-title);
  text-align: center;
}

.hint-box {
  display: flex;
  gap: 12px;
  padding: 12px;
  background: var(--bg-main);
  border-left: 3px solid #667eea;
  border-radius: 4px;
}

.hint-icon {
  font-size: 1.25rem;
  flex-shrink: 0;
}

.hint-text {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--xxs);
  color: var(--text-base);
  line-height: 1.5;
}

.hint-text strong {
  color: var(--text-head);
  font-weight: 700;
}

.upgrade-section {
  background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
  border: 2px dashed #667eea;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
  text-align: center;
}

.upgrade-icon {
  font-size: 3rem;
  margin-bottom: 12px;
}

.upgrade-title {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--lg);
  font-weight: 700;
  color: var(--text-head);
  margin-bottom: 12px;
}

.upgrade-features {
  margin-bottom: 12px;
}

.feature-item {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--sm);
  color: var(--text-base);
  margin-bottom: 4px;
}

.upgrade-price {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--md);
  font-weight: 700;
  color: #667eea;
  margin-bottom: 16px;
}

.upgrade-btn {
  padding: 12px 24px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--sm);
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.upgrade-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.upgrade-btn:active {
  transform: translateY(0);
}

.info-section {
  background: var(--bg-side);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
  text-align: center;
}

.info-icon {
  font-size: 2.5rem;
  margin-bottom: 12px;
}

.info-text {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--sm);
  color: var(--text-base);
  margin-bottom: 16px;
  line-height: 1.5;
}

.info-text strong {
  color: var(--text-head);
}

.info-btn {
  padding: 10px 20px;
  background: var(--bg-main);
  color: var(--text-head);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--sm);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.info-btn:hover {
  background: var(--border);
}

.reset-info {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px;
  background: var(--bg-side);
  border-radius: 8px;
  font-family: 'Roboto Condensed', sans-serif;
  font-size: var(--xxs);
  color: var(--text-base);
}

.reset-icon {
  font-size: 1.25rem;
}

.reset-text strong {
  color: var(--text-head);
  font-weight: 700;
}

@media (max-width: 768px) {
  .card-stats {
    grid-template-columns: 1fr;
  }
  .premium-features {
    grid-template-columns: 1fr;
  }
}
</style>
